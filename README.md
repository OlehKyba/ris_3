# РІС. Практична робота №3.

## Завдання
Встановити стовпчикову базу даних та реляційну базу даних.

Наповнити обидві бази даних згенерованими даними про купівлю товарів в магазині.

Зробити запити до обох баз даних та заміряти час відповіді:
* Порахувати кількість проданового товару; 
* Порахувати вартість проданого товару;
* Порахувати вартість проданого товару за період;
* Порахувати скільки було придбано товару `А` в магазині `В` за період `С`;
* Порахувати скільки було придбано товару `А` в усіх магазинах за період `С`;
* Порахувати сумарну виручку магазинів за період `С`;
* Вивести топ 10 купівель товарів по два за період `С` (наприклад масло, хліб - 1000 разів);
* Вивести топ 10 купівель товарів по три за період `С` (наприклад молоко, масло, хліб - 1000 разів);
* Вивести топ 10 купівель товарів по чотири за період `С`;

## Описання
У файлі [docker-compose.yml](./docker-compose.yml) були налаштовані контейнери `PostgreSQL` та `ClickHouse`.

## Як запустити проєкт?
1. Виконати команду для збору `docker image` з кодом `python`:
```bash
make build
```
2. Запустити БД:
```bash
make run
```
3. Запустити тести:
```bash
make test
```

## Як виглядає результат?
```bash
(venv) ➜  ris_3 git:(master) ✗ make test 
docker-compose run --rm test
Creating ris_3_test_run ... done
INFO:ris_3.bl:Таблиця товарів:
╒══════════╤════════╕
│ назва    │   ціна │
╞══════════╪════════╡
│ картопля │     15 │
├──────────┼────────┤
│ філе     │    120 │
├──────────┼────────┤
│ яйця     │     60 │
├──────────┼────────┤
│ молоко   │     35 │
├──────────┼────────┤
│ хліб     │     25 │
├──────────┼────────┤
│ пиво     │     35 │
├──────────┼────────┤
│ чай      │     40 │
├──────────┼────────┤
│ кава     │    120 │
├──────────┼────────┤
│ масло    │     60 │
├──────────┼────────┤
│ цибуля   │     35 │
╘══════════╧════════╛
INFO:__main__:Було згенеровано 100000 чеків
INFO:__main__:Завантажуємо 100000 чеків у PostgreSQL...
INFO:__main__:Завершено завантаження 100000 чеків у PostgreSQL.
INFO:__main__:Завантажуємо 100000 чеків у ClickHouse...
INFO:__main__:Завершено завантаження 100000 чеків у ClickHouse.
INFO:__main__:1. Порахувати кількість проданового товару.
INFO:ris_3.repositories.repo:SqlSalesRepository.count_sales took 0.02932286262512207 seconds
INFO:__main__:Кількість проданового товару в PostgreSQL: 249734
INFO:ris_3.repositories.repo:ColumnSalesRepository.count_sales took 0.004439830780029297 seconds
INFO:__main__:Кількість проданового товару в ClickHouse: 249734
INFO:__main__:2. Порахувати вартість проданого товару.
INFO:ris_3.repositories.repo:SqlSalesRepository.calculate_income took 0.027067899703979492 seconds
INFO:__main__:Вартість проданого товару в PostgreSQL: 13626690.0
INFO:ris_3.repositories.repo:ColumnSalesRepository.calculate_income took 0.006941795349121094 seconds
INFO:__main__:Вартість проданого товару в ClickHouse: 13626690.0
INFO:__main__:3. Порахувати вартість проданого товару за період: 01.10.2022 - 01.11.2022
INFO:ris_3.repositories.repo:SqlSalesRepository.calculate_income took 0.03653311729431152 seconds
INFO:__main__:Вартість проданого товару за період у PostgreSQL: 4645425.0
INFO:ris_3.repositories.repo:ColumnSalesRepository.calculate_income took 0.030096769332885742 seconds
INFO:__main__:Вартість проданого товару за період у ClickHouse: 4645425.0
INFO:__main__:4. Порахувати скільки було придбано товару "хліб" в магазині "АТБ" за період 01.10.2022 - 01.11.2022
INFO:ris_3.repositories.repo:SqlSalesRepository.count_sales took 0.036429405212402344 seconds
INFO:__main__:Кількість придбаного хлібу в АТБ за жовтень у PostgreSQL: 1683
INFO:ris_3.repositories.repo:ColumnSalesRepository.count_sales took 0.013910770416259766 seconds
INFO:__main__:Кількість придбаного хлібу в АТБ за жовтень у ClickHouse: 1683
INFO:__main__:5. Порахувати скільки було придбано товару "пиво" в усіх магазинах за період 01.10.2022 - 01.11.2022
INFO:ris_3.repositories.repo:SqlSalesRepository.count_sales took 0.036347389221191406 seconds
INFO:__main__:Кількість придбаного пива а жовтень у PostgreSQL: 8550
INFO:ris_3.repositories.repo:ColumnSalesRepository.count_sales took 0.018304824829101562 seconds
INFO:__main__:Кількість придбаного пива а жовтень у ClickHouse: 8550
INFO:__main__:Порахувати сумарну виручку магазинів за період 01.10.2022 - 01.11.2022
INFO:ris_3.repositories.repo:SqlSalesRepository.calculate_income_by_shops took 0.07991504669189453 seconds
INFO:ris_3.bl:Виручка з PostgreSQL:
╒═══════════╤════════════╕
│ магазин   │   прибуток │
╞═══════════╪════════════╡
│ Novus     │     930150 │
├───────────┼────────────┤
│ АТБ       │     942100 │
├───────────┼────────────┤
│ Полісся   │     907845 │
├───────────┼────────────┤
│ Сільпо    │     937275 │
├───────────┼────────────┤
│ Фора      │     928055 │
╘═══════════╧════════════╛
INFO:ris_3.repositories.repo:ColumnSalesRepository.calculate_income_by_shops took 0.020550251007080078 seconds
INFO:ris_3.bl:Виручка з ClickHouse:
╒═══════════╤════════════╕
│ магазин   │   прибуток │
╞═══════════╪════════════╡
│ Novus     │     930150 │
├───────────┼────────────┤
│ АТБ       │     942100 │
├───────────┼────────────┤
│ Полісся   │     907845 │
├───────────┼────────────┤
│ Сільпо    │     937275 │
├───────────┼────────────┤
│ Фора      │     928055 │
╘═══════════╧════════════╛
INFO:__main__:7. Вивести топ 10 купівель товарів по два за період 01.10.2022 - 01.11.2022
INFO:ris_3.repositories.repo:SqlSalesRepository.calculate_top took 0.13147211074829102 seconds
INFO:ris_3.bl:Таблиця з PostgreSQL:
╒════════════════╤═════════════╕
│ товари         │   кількість │
╞════════════════╪═════════════╡
│ картопля, яйця │         201 │
├────────────────┼─────────────┤
│ молоко, пиво   │         193 │
├────────────────┼─────────────┤
│ пиво, яйця     │         190 │
├────────────────┼─────────────┤
│ цибуля, яйця   │         185 │
├────────────────┼─────────────┤
│ масло, чай     │         183 │
├────────────────┼─────────────┤
│ філе, цибуля   │         182 │
├────────────────┼─────────────┤
│ філе, хліб     │         179 │
├────────────────┼─────────────┤
│ молоко, чай    │         178 │
├────────────────┼─────────────┤
│ кава, молоко   │         177 │
├────────────────┼─────────────┤
│ кава, цибуля   │         177 │
╘════════════════╧═════════════╛
INFO:ris_3.repositories.repo:ColumnSalesRepository.calculate_top took 0.04010581970214844 seconds
INFO:ris_3.bl:Таблиця з ClickHouse:
╒════════════════╤═════════════╕
│ товари         │   кількість │
╞════════════════╪═════════════╡
│ картопля, яйця │         201 │
├────────────────┼─────────────┤
│ молоко, пиво   │         193 │
├────────────────┼─────────────┤
│ пиво, яйця     │         190 │
├────────────────┼─────────────┤
│ цибуля, яйця   │         185 │
├────────────────┼─────────────┤
│ масло, чай     │         183 │
├────────────────┼─────────────┤
│ філе, цибуля   │         182 │
├────────────────┼─────────────┤
│ філе, хліб     │         179 │
├────────────────┼─────────────┤
│ молоко, чай    │         178 │
├────────────────┼─────────────┤
│ кава, молоко   │         177 │
├────────────────┼─────────────┤
│ кава, цибуля   │         177 │
╘════════════════╧═════════════╛
INFO:__main__:8. Вивести топ 10 купівель товарів по три за період 01.10.2022 - 01.11.2022
INFO:ris_3.repositories.repo:SqlSalesRepository.calculate_top took 0.14161181449890137 seconds
INFO:ris_3.bl:Таблиця з PostgreSQL:
╒══════════════════════════╤═════════════╕
│ товари                   │   кількість │
╞══════════════════════════╪═════════════╡
│ картопля, молоко, філе   │          74 │
├──────────────────────────┼─────────────┤
│ картопля, хліб, цибуля   │          71 │
├──────────────────────────┼─────────────┤
│ картопля, молоко, хліб   │          68 │
├──────────────────────────┼─────────────┤
│ картопля, цибуля, чай    │          63 │
├──────────────────────────┼─────────────┤
│ масло, молоко, чай       │          63 │
├──────────────────────────┼─────────────┤
│ картопля, молоко, яйця   │          62 │
├──────────────────────────┼─────────────┤
│ хліб, цибуля, чай        │          62 │
├──────────────────────────┼─────────────┤
│ кава, масло, пиво        │          61 │
├──────────────────────────┼─────────────┤
│ картопля, молоко, цибуля │          61 │
├──────────────────────────┼─────────────┤
│ масло, пиво, філе        │          61 │
╘══════════════════════════╧═════════════╛
INFO:ris_3.repositories.repo:ColumnSalesRepository.calculate_top took 0.04420661926269531 seconds
INFO:ris_3.bl:Таблиця з ClickHouse:
╒══════════════════════════╤═════════════╕
│ товари                   │   кількість │
╞══════════════════════════╪═════════════╡
│ картопля, молоко, філе   │          74 │
├──────────────────────────┼─────────────┤
│ картопля, хліб, цибуля   │          71 │
├──────────────────────────┼─────────────┤
│ картопля, молоко, хліб   │          68 │
├──────────────────────────┼─────────────┤
│ картопля, цибуля, чай    │          63 │
├──────────────────────────┼─────────────┤
│ масло, молоко, чай       │          63 │
├──────────────────────────┼─────────────┤
│ картопля, молоко, яйця   │          62 │
├──────────────────────────┼─────────────┤
│ хліб, цибуля, чай        │          62 │
├──────────────────────────┼─────────────┤
│ кава, масло, пиво        │          61 │
├──────────────────────────┼─────────────┤
│ картопля, молоко, цибуля │          61 │
├──────────────────────────┼─────────────┤
│ масло, пиво, філе        │          61 │
╘══════════════════════════╧═════════════╛
INFO:__main__:9. Вивести топ 10 купівель товарів по чотири за період 01.10.2022 - 01.11.2022
INFO:ris_3.repositories.repo:SqlSalesRepository.calculate_top took 0.14630341529846191 seconds
INFO:ris_3.bl:Таблиця з PostgreSQL:
╒════════════════════════════════╤═════════════╕
│ товари                         │   кількість │
╞════════════════════════════════╪═════════════╡
│ кава, масло, філе, цибуля      │          30 │
├────────────────────────────────┼─────────────┤
│ кава, молоко, чай, яйця        │          30 │
├────────────────────────────────┼─────────────┤
│ молоко, філе, хліб, яйця       │          30 │
├────────────────────────────────┼─────────────┤
│ кава, пиво, філе, хліб         │          29 │
├────────────────────────────────┼─────────────┤
│ картопля, молоко, хліб, яйця   │          29 │
├────────────────────────────────┼─────────────┤
│ картопля, молоко, цибуля, яйця │          29 │
├────────────────────────────────┼─────────────┤
│ пиво, філе, цибуля, яйця       │          29 │
├────────────────────────────────┼─────────────┤
│ кава, хліб, чай, яйця          │          28 │
├────────────────────────────────┼─────────────┤
│ картопля, масло, молоко, хліб  │          28 │
├────────────────────────────────┼─────────────┤
│ картопля, філе, хліб, чай      │          28 │
╘════════════════════════════════╧═════════════╛
INFO:ris_3.repositories.repo:ColumnSalesRepository.calculate_top took 0.04727625846862793 seconds
INFO:ris_3.bl:Таблиця з ClickHouse:
╒════════════════════════════════╤═════════════╕
│ товари                         │   кількість │
╞════════════════════════════════╪═════════════╡
│ кава, масло, філе, цибуля      │          30 │
├────────────────────────────────┼─────────────┤
│ кава, молоко, чай, яйця        │          30 │
├────────────────────────────────┼─────────────┤
│ молоко, філе, хліб, яйця       │          30 │
├────────────────────────────────┼─────────────┤
│ кава, пиво, філе, хліб         │          29 │
├────────────────────────────────┼─────────────┤
│ картопля, молоко, хліб, яйця   │          29 │
├────────────────────────────────┼─────────────┤
│ картопля, молоко, цибуля, яйця │          29 │
├────────────────────────────────┼─────────────┤
│ пиво, філе, цибуля, яйця       │          29 │
├────────────────────────────────┼─────────────┤
│ кава, хліб, чай, яйця          │          28 │
├────────────────────────────────┼─────────────┤
│ картопля, масло, молоко, хліб  │          28 │
├────────────────────────────────┼─────────────┤
│ картопля, філе, хліб, чай      │          28 │
╘════════════════════════════════╧═════════════╛
```

## Висновки
На цій практичній роботі я налаштував дві БД за допомогою технології `Docker` та `docker-compose`:
`PostgreSQL` (реляційна) та `ClickHouse` (колункова). 
Також я написав генерацію випадкових даних та агрегаційні запити до них за допомогою мови програмування `python`.
По результатам виконання цих запитів ми можемо зробити висновок, що колункові БД краще підходять 
для виконання агрегаціних запитів, про що свідчить час виконання тестів. 
Колункові БД значно швидше виконують агрегаційні запити, ніж реляційні.